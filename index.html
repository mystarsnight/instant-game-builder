<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Instant Game Builder</title>
<meta name="viewport" content="width=device-width, initial-scale=1">
<style>
body{font-family:Arial;background:#b3d9ff;margin:0;padding:10px}
#app{background:#fff;border-radius:12px;padding:12px;max-width:900px;margin:auto}
textarea,button{width:100%;padding:10px;margin:6px 0;border-radius:8px;font-size:14px}
button{background:#4caf50;color:#fff;border:none;cursor:pointer}
#gameArea{margin-top:15px;height:350px;border-radius:10px;background:#e3f2fd;position:relative;overflow:hidden}
.obj{position:absolute;width:64px;height:64px;border-radius:12px;cursor:pointer;background-size:cover;background-position:center}
#stats{margin-top:10px;font-weight:bold}
.listItem{padding:6px;background:#eee;margin:4px 0;border-radius:6px;cursor:pointer}
.notice{background:#222;color:#fff;padding:10px;border-radius:8px;margin:6px 0;display:none}
</style>
</head>
<body>

<div id="app">
<h2>Instant Game Builder</h2>

<div id="notice" class="notice"></div>

<h3>Game Rules</h3>
<textarea id="input" rows="6" placeholder="
spawn player
spawn coin
click coin gain 1
score to win 10
press arrow move player
"></textarea>

<button onclick="buildGame()">Build & Play</button>
<button onclick="saveGame()">Save (Local)</button>
<button onclick="shareGame()">Copy Share Link</button>

<div id="gameArea"></div>
<div id="stats"></div>

<h3>My Games (Local)</h3>
<div id="myGames"></div>
</div>

<script>
const notice=document.getElementById('notice')
function show(msg){notice.innerText=msg;notice.style.display='block';setTimeout(()=>notice.style.display='none',2500)}

let rules=[],objects={},score=0,winScore=999,keys={}

function buildGame(){
  gameArea.innerHTML=''
  objects={}
  score=0
  winScore=999
  rules=input.value.split('\n').map(l=>l.trim()).filter(Boolean)

  rules.forEach(r=>{
    if(r.startsWith('spawn')) spawn(r.split(' ')[1])
    if(r.startsWith('score to win')) winScore=parseInt(r.split(' ').pop())
  })
  update()
}

function spawn(name){
  const d=document.createElement('div')
  d.className='obj'
  d.style.backgroundImage=`url(${generateAIImage(name)})`
  d.style.left=Math.random()*80+'%'
  d.style.top=Math.random()*80+'%'
  d.onclick=()=>{
    rules.forEach(r=>{
      if(r.startsWith('click '+name)&&r.includes('gain')){
        score+=parseInt(r.split('gain')[1])
      }
    })
    update()
  }
  gameArea.appendChild(d)
  objects[name]=d
}

function generateAIImage(name){
  const colors=['#ef5350','#42a5f5','#66bb6a','#ffa726','#ab47bc']
  let h=0;for(let i=0;i<name.length;i++)h+=name.charCodeAt(i)
  const c=colors[h%colors.length]
  const l=name[0].toUpperCase()
  const svg=`<svg xmlns='http://www.w3.org/2000/svg' width='64' height='64'>
  <rect width='100%' height='100%' rx='12' fill='${c}'/>
  <text x='50%' y='55%' text-anchor='middle' font-size='32' fill='white' font-family='Arial'>${l}</text>
  </svg>`
  return 'data:image/svg+xml;base64,'+btoa(svg)
}

window.onkeydown=e=>keys[e.key]=true
window.onkeyup=e=>keys[e.key]=false

setInterval(()=>{
  if(objects.player && rules.includes('press arrow move player')){
    let p=objects.player
    let x=p.offsetLeft,y=p.offsetTop
    if(keys.ArrowLeft)x-=5
    if(keys.ArrowRight)x+=5
    if(keys.ArrowUp)y-=5
    if(keys.ArrowDown)y+=5
    p.style.left=x+'px'
    p.style.top=y+'px'
  }
},40)

function update(){
  if(score>=winScore){
    stats.innerText='YOU WIN ðŸŽ‰'
    show('You win!')
  }else{
    stats.innerText='Score: '+score+' / '+winScore
  }
}

// ===== LOCAL SAVE =====
function saveGame(){
  const games=JSON.parse(localStorage.getItem('myGames')||'[]')
  games.push({rules:input.value})
  localStorage.setItem('myGames',JSON.stringify(games))
  show('Saved locally')
  loadMyGames()
}

function loadMyGames(){
  const games=JSON.parse(localStorage.getItem('myGames')||'[]')
  myGames.innerHTML=''
  games.forEach((g,i)=>{
    const d=document.createElement('div')
    d.className='listItem'
    d.innerText='Game '+(i+1)
    d.onclick=()=>{input.value=g.rules;buildGame()}
    myGames.appendChild(d)
  })
}
loadMyGames()

// ===== SHARE =====
function shareGame(){
  const data=btoa(encodeURIComponent(input.value))
  navigator.clipboard.writeText(location.origin+location.pathname+'?game='+data)
  show('Link copied')
}

const p=new URLSearchParams(location.search)
if(p.has('game')){
  input.value=decodeURIComponent(atob(p.get('game')))
  buildGame()
}
</script>
</body>
</html>
