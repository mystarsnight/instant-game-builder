<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Instant Game Builder</title>
<meta name="viewport" content="width=device-width, initial-scale=1">
<style>
body{margin:0;font-family:Arial;background:#b3d9ff}
#app{max-width:900px;margin:auto;background:#fff;padding:12px;border-radius:12px}
textarea,button{width:100%;padding:10px;margin:6px 0;border-radius:8px;font-size:14px}
button{background:#4caf50;color:#fff;border:none}
button.small{width:auto;padding:6px 10px;font-size:12px}
#game{height:320px;background:#e3f2fd;border-radius:10px;position:relative;overflow:hidden}
.obj{width:60px;height:60px;border-radius:12px;position:absolute;
display:flex;align-items:center;justify-content:center;
color:#fff;font-weight:bold;user-select:none}
.row{display:flex;gap:6px;background:#eee;padding:6px;border-radius:6px;margin:4px 0}
#notice{background:#222;color:#fff;padding:8px;border-radius:6px;display:none}
</style>
</head>
<body>

<div id="app">
<h2>Instant Game Builder</h2>

<div id="notice"></div>

<textarea id="rules" rows="6" placeholder="Example:
spawn player
spawn coin
click coin gain 1
score to win 5
move arrows"></textarea>

<button onclick="buildGame()">Build & Play</button>
<button onclick="aiGame()">ðŸ¤– AI Make Game</button>
<button onclick="saveGame()">ðŸ’¾ Save</button>
<button onclick="copyLink()">ðŸ”— Copy Link</button>

<div id="game"></div>
<div id="stats"></div>

<h3>My Games</h3>
<div id="library"></div>
</div>

<script>
/* ---------- BASIC ---------- */
const rulesBox=document.getElementById("rules")
const game=document.getElementById("game")
const stats=document.getElementById("stats")
const lib=document.getElementById("library")
const notice=document.getElementById("notice")
function msg(t){notice.innerText=t;notice.style.display="block";setTimeout(()=>notice.style.display="none",2000)}

let rules=[],objs={},score=0,win=5,keys={}

/* ---------- BUILD ---------- */
function buildGame(){
  game.innerHTML=""
  objs={}
  score=0
  win=5
  rules=rulesBox.value.split("\n").map(r=>r.trim()).filter(Boolean)

  rules.forEach(r=>{
    if(r.startsWith("spawn ")) spawn(r.split(" ")[1])
    if(r.startsWith("score to win")) win=parseInt(r.split(" ").pop())||5
  })
  update()
}

/* ---------- OBJECTS ---------- */
function spawn(name){
  const d=document.createElement("div")
  d.className="obj"
  d.style.left=Math.random()*80+"%"
  d.style.top=Math.random()*80+"%"
  d.style.background=colorFromName(name)
  d.innerText=name[0].toUpperCase()

  d.onclick=()=>{
    rules.forEach(r=>{
      if(r.startsWith("click "+name) && r.includes("gain")){
        score+=parseInt(r.split("gain")[1])||1
      }
    })
    update()
  }

  game.appendChild(d)
  objs[name]=d
}

function colorFromName(n){
  const c=["#e53935","#1e88e5","#43a047","#fb8c00","#8e24aa"]
  let h=0;for(let x of n)h+=x.charCodeAt(0)
  return c[h%c.length]
}

/* ---------- MOVEMENT ---------- */
window.onkeydown=e=>keys[e.key]=true
window.onkeyup=e=>keys[e.key]=false

setInterval(()=>{
  if(objs.player && rules.includes("move arrows")){
    let p=objs.player
    let x=p.offsetLeft,y=p.offsetTop
    if(keys.ArrowLeft)x-=5
    if(keys.ArrowRight)x+=5
    if(keys.ArrowUp)y-=5
    if(keys.ArrowDown)y+=5
    p.style.left=x+"px"
    p.style.top=y+"px"
  }
},40)

/* ---------- UPDATE ---------- */
function update(){
  if(score>=win){
    stats.innerText="YOU WIN ðŸŽ‰"
    msg("You win!")
  }else{
    stats.innerText="Score: "+score+" / "+win
  }
}

/* ---------- AI ---------- */
function aiGame(){
  const t=prompt("Describe game:\ncollect coins to 10","collect coins to 10")
  if(!t) return
  const n=t.match(/\d+/)
  let out=[
    "spawn player",
    "spawn coin",
    "click coin gain 1",
    "move arrows",
    "score to win "+(n?n[0]:5)
  ]
  rulesBox.value=out.join("\n")
  buildGame()
  msg("AI game created")
}

/* ---------- SAVE SYSTEM ---------- */
function getGames(){return JSON.parse(localStorage.getItem("games")||"[]")}
function setGames(g){localStorage.setItem("games",JSON.stringify(g))}

function saveGame(){
  const name=prompt("Game name","My Game")
  if(!name) return
  const g=getGames()
  g.push({id:Date.now(),name,rules:rulesBox.value})
  setGames(g)
  loadGames()
  msg("Saved")
}

function loadGames(){
  lib.innerHTML=""
  getGames().forEach(g=>{
    const r=document.createElement("div")
    r.className="row"
    r.innerHTML="<b>"+g.name+"</b>"

    r.append(
      btn("Play",()=>{rulesBox.value=g.rules;buildGame()}),
      btn("Rename",()=>{
        const n=prompt("New name",g.name)
        if(n){g.name=n;setGames(getGames());loadGames()}
      }),
      btn("Delete",()=>{
        if(confirm("Delete?")){
          setGames(getGames().filter(x=>x.id!==g.id))
          loadGames()
        }
      })
    )
    lib.appendChild(r)
  })
}

function btn(t,f){const b=document.createElement("button");b.className="small";b.innerText=t;b.onclick=f;return b}
loadGames()

/* ---------- SHARE ---------- */
function copyLink(){
  const d=btoa(encodeURIComponent(rulesBox.value))
  navigator.clipboard.writeText(location.origin+location.pathname+"?g="+d)
  msg("Link copied")
}

const q=new URLSearchParams(location.search)
if(q.has("g")){
  rulesBox.value=decodeURIComponent(atob(q.get("g")))
  buildGame()
}
</script>
</body>
</html>
